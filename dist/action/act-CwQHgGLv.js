(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();class z{constructor(){this.activeOns=[]}emit(e,t={}){const s=new CustomEvent(e,{detail:t});window.dispatchEvent(s)}on(e,t){const s=n=>{t.call(null,n)};this._removeOne(e,t),this.activeOns.push({eventName:e,listener:t,listenerWindow:s}),window.addEventListener(e,s)}once(e,t){const s=n=>{t.call(null,n),this._removeOne(e,t,s)};window.addEventListener(e,s,{once:!0})}off(e,t){this._removeOne(e,t)}offAll(e){let t=0;for(const s of this.activeOns)s.eventName===e&&(window.removeEventListener(s.eventName,s.listenerWindow),this.activeOns.splice(t,1)),t++}getListeners(e){let t=[...this.activeOns];return t=t.filter(s=>s.eventName===e),t}_removeOne(e,t){if(!t)throw new Error("eventEmitter._removeOne Error: listener is not defined");let s=0;for(const n of this.activeOns)n.eventName===e&&n.listener.toString()===t.toString()&&(window.removeEventListener(n.eventName,n.listenerWindow),this.activeOns.splice(s,1)),s++}}const E=new z;class G{constructor(){this.previous={uri:"",ctrl:null},this.current={uri:"",ctrl:null}}_setPrevious(){this.previous={...this.current}}_setCurrent(e){const t=this.getCurrentURI();this.current={uri:t,ctrl:e}}async _resetPreviousController(){const e=this.previous.ctrl;if(!e)return;await e.__destroy(),e.$destroyflight&&await e.$destroyflight(),e.ddUNLISTEN(),e.emptyModel();const t=Object.keys(e);for(const s of t)s!=="$appName"&&s!=="$auth"&&s!=="$fridge"&&s!=="$httpClient"&&s!=="$debugOpts"&&s!=="$destroyflight"&&s!=="$model"&&s!=="$modeler"&&s!=="$dd"&&delete e[s];e.$elem={},e.$dd.listeners=[],e.$model={}}async navigMdw(e){C._setPrevious(),await C._resetPreviousController(),C._setCurrent(e)}getPrevioustURI(){return this.previous.uri}getCurrentURI(){return window.location.pathname+window.location.search}onPushstate(e){E.on("pushstate",e)}onPopstate(e){window.addEventListener("popstate",e)}onHashchange(e){window.addEventListener("hashchange",e)}onUrlChange(e){this.onPushstate(e),this.onPopstate(e)}goto(e,t,s){if(!e)throw new Error('The argument "url" is not defined');t||(t={}),s||(s=""),t={...t,url:e},window.history.pushState(t,s,e),E.emit("pushstate",t)}goblind(e,t,s){if(!e)throw new Error('The argument "url" is not defined');t||(t={}),s||(s=""),t={...t,url:e},window.history.pushState(t,s,e)}forward(){window.history.forward()}back(){window.history.back()}history(e){window.history.go(e)}reload(){window.location.reload()}}const C=new G;class K{constructor(e){this.$appName=e||"dodoApp",window[this.$appName]={i18n:{}},this.ctrls={},this.ctrlConstants={$appName:this.$appName,$fridge:{}},this.$debugOpts={},this._setAppStyle()}fridge(e,t){return this.ctrlConstants.$fridge[e]=t,this}httpClient(e){return this.ctrlConstants.$httpClient=e,this}auth(e){for(const t of Object.keys(this.ctrls)){const s=this.ctrls[t].$auth;s.login=s.login.bind(s),s.logout=s.logout.bind(s),s.getLoggedUserInfo=s.getLoggedUserInfo.bind(s),s.setLoggedUserInfo=s.setLoggedUserInfo.bind(s),s.getJWTtoken=s.getJWTtoken.bind(s)}return this.ctrlConstants.$auth=e,this}debug(e){return this.$debugOpts=e,this.ctrlConstants.$debugOpts=this.$debugOpts,this}async i18n(e){if(!e){const t=await Object.assign({});e={};for(const s in t){const n=await t[s](),i=s.split("/"),r=i[2],d=i[3].replace(".json","");e[r]||(e[r]={}),e[r][d]=n}}window[this.$appName].i18n=e}controller(e){if(!e)throw new Error(`Controller "${e.name}" is not defined or not injected in the App.`);const t=new e(this);t.controllerMdw.bind(t)(),this._saveController(e.name,t)}_saveController(e,t){for(const[s,n]of Object.entries(this.ctrlConstants))t[s]=n;return this.ctrls[e]=t,t}_setAppStyle(){const s=["dd-setinitial","dd-elem","dd-if","dd-elseif","dd-else","dd-visible","dd-text","dd-html","dd-value","dd-disabled","dd-checked","dd-selected","dd-class","dd-style","dd-src","dd-attr","dd-foreach","dd-each","dd-loop","dd-repeat","dd-mustache"].map(i=>`[${i}-hide]`).join(","),n=document.createElement("style");n.textContent=`${s} { display: none !important; }`,n.setAttribute("type","text/css"),document.head.appendChild(n)}}class Y{_getControllerValue(e){if(!e.includes("$$"))try{let t=new Function(`const val = this.${e}; return val;`);return t=t.bind(this),t()}catch(t){console.warn(`_getControllerValue (Bad controller property: this.${e})`,t)}}_getControllerValue_alt(e){const t=e.split("."),s=t[0];let n=this[s];return t.forEach((i,r)=>{r!==0&&n!=null&&(n=n[i])}),n}_setControllerValue(e,t){try{let s=new Function("val2",`this.${e} = val2`);s=s.bind(this,t),s()}catch(s){console.error(`_setControllerValue (${e})`,s)}}_setControllerValue_alt(e,t){const s=e.split(".");let n=1,i=this;for(const r of s)n!==s.length?((i[r]===void 0||i[r]===null||i[r]===NaN)&&(i[r]={}),i=i[r]):i[r]=t,n++}_listElements(e,t){let s=document.querySelectorAll(`[${e}]:not([dd-render-disabled])`);return s=Array.from(s),s=s.filter(n=>{let i=n.getAttribute(e)||"";i=i.trim();const{base:r,opts:d}=this._decomposeAttribute(i);return d.includes("forceRender")||this._hasDdRender(n,"enabled")?!0:t?i.includes("$model."+t)||/\(((?!\$\{|\$\$).)*\)/.test(i):!0}),s}_sortElements(e){return e=Array.from(e),e=e.sort((t,s)=>{const n=+t.getAttribute("dd-priority")||0;return(+s.getAttribute("dd-priority")||0)-n}),e}_elemShow(e,t){e.removeAttribute(`${t}-hide`)}_elemHide(e,t){e.setAttribute(`${t}-hide`,"")}_getSiblings(e,t){const s=[];if(!e.parentNode)return s;let n=e.parentNode.firstChild,i=!1;for(;n;){if(n===e&&(i=!0),i&&n!==e&&n.nodeType===1&&n.hasAttribute(t[0])){i=!1;break}if(i&&n.nodeType===1){for(const r of t)n.hasAttribute(r)&&s.push(n);if(i&&n.hasAttribute(t[t.length-1])){i=!1;break}}n=n.nextSibling}return s}_getParents(e,t){const s=[];if(!e.parentNode)return s;let n=e.parentNode;for(;n!==null&&n!==document;){for(const i of t)n.hasAttribute(i)&&s.push(n);n=n.parentNode}return s}_decomposeAttribute(e){let t=e.split("--")||[];return t=t.map(n=>n.trim()),{base:t.shift(),opts:t}}_setElementValue(e,t=""){typeof t=="object"?e.type==="textarea"?t=JSON.stringify(t,null,2):t=JSON.stringify(t):t=this._val2str(t),e.value=t,e.setAttribute("value",t)}_setElementChecked(e,t=""){t=this._val2str(t),t.includes(e.value)?(e.checked=!0,e.setAttribute("checked","")):(e.checked=!1,e.removeAttribute("checked"))}_setElementSelected_one(e,t=""){t=this._val2str(t);for(const s of e.options)t===s.value?(s.selected=!0,s.setAttribute("selected","")):(s.selected=!1,s.removeAttribute("selected"))}_setElementSelected_multiple(e,t=""){for(const s of e.options)t.includes(s.value)?(s.selected=!0,s.setAttribute("selected","")):(s.selected=!1,s.removeAttribute("selected"))}_getElementValue(e,t=!0){let s;if(e.type==="checkbox"){const n=document.querySelectorAll(`[name="${e.name}"]`),i=[];let r=1;for(const d of n){let o=d.value;t&&(o=this._stringTypeConvert(d.value)),d.checked&&(i.push(o),s=i),r===n.length&&!s&&(s=[]),r++}}else if(e.type==="select-multiple"){const n=e.selectedOptions,i=[];let r=1;for(const d of n){let o=d.value;t&&(o=this._stringTypeConvert(d.value)),i.push(o),s=i,r===n.length&&!s&&(s=[]),r++}}else if(e.type==="radio"){let n=e.value;t&&(n=this._stringTypeConvert(e.value)),e.checked&&(s=n)}else if(e.type==="number")s=e.valueAsNumber||void 0;else if(e.type==="password")s=e.value;else if(e.type==="file"&&e.multiple)s=e.files;else if(e.type==="file")s=e.files[0];else{let n=e.value;t&&(n=this._stringTypeConvert(e.value)),s=n}return s}_clone_define(e,t,s){const n=e.cloneNode(!0);return n.removeAttribute(t),t==="dd-if"&&(n.removeAttribute("dd-else"),n.removeAttribute("dd-elseif")),n.setAttribute(`${t}-clone`,s),n}_clone_insert(e,t){e.parentNode.insertBefore(t,e)}_clone_insert_append(e,t){e.parentElement.appendChild(t)}_clone_remove(e,t){const s=e.getAttribute("dd-id");if(!s)return;const n=document.querySelectorAll(`[${t}-clone][dd-id="${s}"]`);for(const i of n)i.remove()}_clone_remove_ddMustache(e){const t=e.previousElementSibling;t&&t.hasAttribute("dd-mustache-clone")&&t.remove()}_setDdRender(e,t="disabled"){const s=`dd-render-${t}`;e.setAttribute(s,""),[...this.$dd.noncloner_directives,"dd-mustache"].forEach(i=>{e.querySelectorAll(`[${i}]`).forEach(d=>{d.setAttribute(s,"")})})}_delDdRender(e,t="disabled"){const s=`dd-render-${t}`;e.removeAttribute(s),[...this.$dd.noncloner_directives,"dd-mustache"].forEach(i=>{e.querySelectorAll(`[${i}]`).forEach(d=>{d.removeAttribute(s)})})}_purgeDdRender(e="disabled"){const t=`dd-render-${e}`,s=document.querySelectorAll(`[${t}]`);for(const n of s)n.removeAttribute(t)}_hasDdRender(e,t="disabled"){const s=`dd-render-${t}`;return e.hasAttribute(s)}_solveExpression(e,...t){const s=t.map(r=>Object.keys(r)[0]),n=t.map(r=>Object.values(r)[0]);let i;try{let r=new Function(...s,`return ${e};`);r=r.bind(this);try{i=r(...n),i=i==null||i===NaN?"":i}catch(d){this._printError(`_solveExpression:: Error in expression execution "${e}"`,d),console.error(d)}}catch(r){this._printError(`_solveExpression:: Error in expression definition "${e}"`,r),console.error(r)}return i}_solveMustache(e){const t="{{",s="}}",n=new RegExp(`${t}(.+?)${s}`,"g"),i=e.match(n)||[];for(const r of i){const d=r.replace(t,"").replace(s,"").trim();let o=this._solveExpression(d);o=o.toString(),e=e.replace(r,o)}return e}_solveTemplateLiteral(e="",t={},s=""){let n="";const i=[],r=[];for(const o of Object.entries(t)){const l=o[0],a=o[1];i.push(l),r.push(a)}if(e=e.replace(/\&amp\;/g,"&"),s){const o=new RegExp(`\\${s}{`,"g");e=e.replace(o,"${")}const d="`"+e+"`";n+=`
      const txt = ${d};
      return txt;
    `;try{let o=new Function(...i,n);o=o.bind(this),e=o(...r)}catch(o){const l=e.match(/\$\{[^\}]+\}/g);throw new Error(`_solveTemplateLiteral:: Probably error in one of the string interpolations: ${l} 
`+o.message)}return e}_solveDoubledollar(e,t,s,n){const i=/^this\./.test(t)?`${t}[${n}]`:`this.${t}[${n}]`,r=new RegExp(`\\$\\$${s}|this\\.\\$\\$${s}`,"g");return e=e.replace(r,i),e}_solveBase(e){let t="",s="";if(/^\(.*\)$/.test(e)){s=this._solveMustache(e);const n=s;t=n?this._solveExpression(n):""}else s=e.replace(/^this\./,""),s=this._solveMustache(s),t=s?this._getControllerValue(s):"";return{val:t,prop_solved:s}}_funcParse(e,t,s){if(!e)return{};const n=e.match(/^(.+)\((.*)\)$/);if(!n)return console.error(`_funcParseErr: Function "${e}" has bad definition.`),{};const i=n[1]||"",r=n[2]?n[2].trim():"",d=r?r.split(",").map(o=>{if(o=o.trim(),o==="$element")o=t;else if(o==="$value")o=this._getElementValue(t,!0);else if(o==="$event")o=s;else if(/"|'/.test(o))o=o.replace(/\'/g,"");else if(/^-?\d+\.?\d*$/.test(o)&&!/\'/.test(o))o=+o;else if(o==="true"||o==="false")o=JSON.parse(o);else if(/^\/.+\/i?g?$/.test(o)){const l=o.match(/^\/(.+)\/(i?g?)$/);o=new RegExp(l[1],l[2])}else if(/^\$model\./.test(o)){const l=o;o=this._getControllerValue(l)}else if(/^this\./.test(o)){const l=o.replace(/^this\./,"");o=this._getControllerValue(l)}else{const l=o;o=this._getControllerValue(l)}return o}):[];return{funcName:i,funcArgs:d,funcArgsStr:r}}async _funcExe(e,t){try{if(/\./.test(e)){let s=e.split(".")||[];s=s.filter(r=>r!=="this");let n=this,i;for(const r of s)n=n[r],typeof n=="object"&&(i=n);n=n.bind(i),await n(...t)}else{if(!this[e])throw new Error(`Method "${e}" is not defined in the "${this.constructor.name}" controller.`);await this[e](...t)}}catch(s){console.error(s)}}async _funcsExe(e,t,s){const n=e.split(";").filter(i=>!!i).map(i=>i.trim());for(const i of n){const{funcName:r,funcArgs:d}=this._funcParse(i,t,s);await this._funcExe(r,d)}}_pipeExe(e,t){if(e==null||e&&typeof e!="string")return"";e=e.replace(/\n/g," ").replace(/\s+/g," ").replace(/\'|\`/g,"").trim();const s=t.replace("pipe:","").trim(),n=`const str = '${e}'.${s}; return str;`;try{return e=new Function(n)(),e}catch{this._printError("_pipeExe:: "+n)}}async _exeFuncsOrExpression(e,t,s){if(/^\(.*\)$/.test(e)){const i=this._solveMustache(e);this._solveExpression(i)}else{const n=e;await this._funcsExe(n,t,s)}}_uid_generate(){const t=(Date.now()/1e3+"").split(".")[1],s=Math.round(Math.random()*1e3);return"uid_"+t+"_"+s}_uid(e){const t=this._uid_generate();e.setAttribute("dd-id",t)}_hasDirectives(e,t){let s="";for(const n of t){if(e.hasAttribute(n)){s=n;break}const i=e.querySelectorAll(`[${n}]`);for(const r of i)if(r.hasAttribute(n)){s=n;break}}return s}_stringTypeConvert(e){function t(s){try{JSON.parse(s)}catch{return!1}return!0}return e&&!isNaN(e)&&!/\./.test(e)?e=parseInt(e,10):e&&!isNaN(e)&&/\./.test(e)?e=parseFloat(e):(e==="true"||e==="false"||t(e))&&(e=JSON.parse(e)),e}_val2str(e){return typeof e=="string"?e=e:typeof e=="number"||typeof e=="boolean"?e=e.toString():typeof e=="object"?e=JSON.stringify(e):e=e,e}_debug(e,t,s,n){const i=this.$debugOpts||{};return i&&i[e]&&console.log(`%c ${t}`,`color: ${s}; background: ${n}`),i}_printError(e){console.log(`%c ERROR:: ${e}`,"color:Red; background:Yellow")}_printWarn(e){console.log(`%c WARNING:: ${e}`,"color:Maroon; background:LightYellow")}_isValidVariableName(e){return/^[_\$A-Za-z0-9]+$/.test(e)}async _delay(e){await new Promise(t=>setTimeout(t,e))}}class X extends Y{constructor(){super()}ddUNLISTEN(){this._debug("ddUNLISTEN",`------- ddUNLISTEN (start) ctrl: ${this.constructor.name} -------`,"orange","#FFD8B6");let e=1;for(const t of this.$dd.listeners)t.elem.removeEventListener(t.eventName,t.handler),this._debug("ddUNLISTEN",`${e}. killed:: ${t.attrName} --- ${t.eventName} --- ${t.elem.localName} -- ${t.elem.innerHTML} -- ctrl:: ${this.constructor.name}`,"orange"),e++;this.$dd.listeners=[],this._debug("ddUNLISTEN","------- ddUNLISTEN (end) -------","orange","#FFD8B6")}ddHref(){this._debug("ddHref","--------- ddHref ------","orange","#F4EA9E");const e="dd-href",t=this._listElements(e,"");this._debug("ddHref",`found elements:: ${t.length}`,"orange");for(const s of t){const n=async r=>{r.preventDefault();const d=s.getAttribute("dd-href"),{base:o,opts:l}=this._decomposeAttribute(d),{val:a,prop_solved:c}=this._solveBase(o);this._debug("ddHref",`dd-href="${d}" :: ${o} --> ${c} = ${a}`,"orangered");const h=a||s.getAttribute("href"),p={href:h},u=s.innerText?s.innerText.trim():"";h&&C.goto(h,p,u),this._debug("ddHref",`Executed ddHref listener -->  href: ${h}, ctrl:: ${this.constructor.name}`,"orangered")},i="click";s.addEventListener(i,n),this.$dd.listeners.push({attrName:e,elem:s,handler:n,eventName:i}),this._debug("ddHref",`pushed::  tag: ${s.localName} | href="${s.pathname}" | ddListeners: ${this.$dd.listeners.length}`,"orange")}}ddSet(){this._debug("ddSet","--------- ddSet ------","orange","#F4EA9E");const e="dd-set",t=this._listElements(e,"");this._debug("ddSet",`found elements:: ${t.length}`,"orange");for(const s of t){const n=s.getAttribute(e),{base:i,opts:r}=this._decomposeAttribute(n);let d=i.replace(/^this\./,"");d=this._solveMustache(d);const o=r[0]==="convertType",l=async c=>{const h=this._getElementValue(s,o);this._setControllerValue(d,h),this._debug("ddSet",`Executed ddSet listener --> ${i} -> ${d} = ${h} - convertType: ${o}`,"orangered")},a="input";s.addEventListener(a,l),this.$dd.listeners.push({attrName:e,elem:s,handler:l,eventName:a}),this._debug("ddSet",`pushed::  tag: ${s.localName} | dd-set="${n}" | ctrl="${this.constructor.name}" | ddListeners: ${this.$dd.listeners.length}`,"orange")}}ddModel(){this._debug("ddModel","--------- ddModel ------","orange","#F4EA9E");const e="dd-model",t=this._listElements(e,"");this._debug("ddModel",`found elements:: ${t.length}`,"orange");for(const s of t){const n=s.getAttribute(e),{base:i,opts:r}=this._decomposeAttribute(n);let d=i.replace(/^this\./,"");d&&!d.includes("$model")&&(d="$model."+d),d=this._solveMustache(d);const o=r[0]==="convertType",l=this._getControllerValue(d);s.type==="checkbox"||s.type==="radio"?this._setElementChecked(s,l):s.type==="select-one"?(this._setElementValue(s,l),this._setElementSelected_one(s,l)):s.type==="select-multiple"?(this._setElementValue(s,l),this._setElementSelected_multiple(s,l)):this._setElementValue(s,l),this._debug("ddModel",`ddModel set the element value  --> ${i} -> ${d} = ${l} | elem.type:: ${s.type}`,"orangered");const a=async h=>{const p=this._getElementValue(s,o);this._setControllerValue(d,p),this._debug("ddModel",`Executed ddModel listener --> ${i} -> ${d} = ${p}`,"orangered")},c="input";s.addEventListener(c,a),this.$dd.listeners.push({attrName:e,elem:s,handler:a,eventName:c}),this._debug("ddModel",`pushed::  tag: ${s.localName} | dd-set="${n}" | ctrl="${this.constructor.name}" | ddListeners: ${this.$dd.listeners.length}`,"orange")}}ddClick(){this._debug("ddClick","--------- ddClick ------","orange","#F4EA9E");const e="dd-click",t=this._listElements(e,"");this._debug("ddClick",`found elements:: ${t.length}`,"orange");for(const s of t){const n=s.getAttribute(e),{base:i,opts:r}=this._decomposeAttribute(n),d=r.includes("preventDefault"),o=async a=>{d&&a.preventDefault(),await this._exeFuncsOrExpression(i,s,a),this._debug("ddClick",`Executed ddClick listener --> ${i} | preventDefault: ${d}`,"orangered")},l="click";s.addEventListener(l,o),this.$dd.listeners.push({attrName:e,elem:s,handler:o,eventName:l}),this._debug("ddClick",`pushed::  tag: ${s.localName} | dd-click="${n}" | preventDefault: ${d} | ddListeners: ${this.$dd.listeners.length}`,"orange")}}ddEnter(){this._debug("ddEnter","--------- ddEnter ------","orange","#F4EA9E");const e="dd-enter",t=this._listElements(e,"");this._debug("ddEnter",`found elements:: ${t.length}`,"orange");for(const s of t){const n=s.getAttribute(e),{base:i,opts:r}=this._decomposeAttribute(n),d=r.includes("preventDefault"),o=async a=>{(a.code?a.code.toLowerCase():"")==="enter"&&(d&&a.preventDefault(),await this._exeFuncsOrExpression(i,s,a),this._debug("ddEnter",`Executed ddEnter listener --> ${i}`,"orangered"))},l="keyup";s.addEventListener(l,o),this.$dd.listeners.push({attrName:e,elem:s,handler:o,eventName:l}),this._debug("ddEnter",`pushed::  tag: ${s.localName} | dd-enter="${n}" | ddListeners: ${this.$dd.listeners.length}`,"orange")}}ddKeyup(){this._debug("ddKeyup","--------- ddKeyup ------","orange","#F4EA9E");const e="dd-keyup",t=this._listElements(e,"");this._debug("ddKeyup",`found elements:: ${t.length}`,"orange");for(const s of t){const n=s.getAttribute(e),{base:i,opts:r}=this._decomposeAttribute(n),d=r[0],o=async a=>{const c=a.code?a.code.toLowerCase():"";d&&d!==c||(await this._exeFuncsOrExpression(i,s,a),this._debug("ddKeyup",`Executed ddKeyup listener --> ${i} | eventCode: ${c}`,"orangered"))},l="keyup";s.addEventListener(l,o),this.$dd.listeners.push({attrName:e,elem:s,handler:o,eventName:l}),this._debug("ddKeyup",`pushed::  tag: ${s.localName} | dd-keyup="${n}" | ctrl="${this.constructor.name}" | ddListeners: ${this.$dd.listeners.length}`,"orange")}}ddChange(){this._debug("ddChange","--------- ddChange ------","orange","#F4EA9E");const e="dd-change",t=this._listElements(e,"");this._debug("ddChange",`found elements:: ${t.length}`,"orange");for(const s of t){const n=s.getAttribute(e),{base:i}=this._decomposeAttribute(n),r=async o=>{await this._exeFuncsOrExpression(i,s,o),this._debug("ddChange",`Executed ddChange listener --> ${i}`,"orangered")},d="change";s.addEventListener(d,r),this.$dd.listeners.push({attrName:e,elem:s,handler:r,eventName:d}),this._debug("ddChange",`pushed::  tag: ${s.localName} | dd-change="${n}" | ctrl="${this.constructor.name}" | ddListeners: ${this.$dd.listeners.length}`,"orange")}}ddEvt(){this._debug("ddEvt","--------- ddEvt ------","orange","#F4EA9E");const e="dd-evt",t=this._listElements(e,"");this._debug("ddEvt",`found elements:: ${t.length}`,"orange");for(const s of t){const n=s.getAttribute(e),i=n.split("&&").map(r=>r.trim());for(const r of i){const{base:d,opts:o}=this._decomposeAttribute(r),l=o[0];if(!l){this._printError(`dd-evt="${n}" -> The eventName is not defined`);continue}const a=async c=>{await this._exeFuncsOrExpression(d,s,c),this._debug("ddEvt",`Executed ddEvt listener --> ${d}`,"orangered")};s.addEventListener(l,a),this.$dd.listeners.push({attrName:e,elem:s,handler:a,eventName:l}),this._debug("ddEvt",`pushed::  tag: ${s.localName} | dd-evt="${n}" | ctrl="${this.constructor.name}" | ddListeners: ${this.$dd.listeners.length}`,"orange")}}}}class Z extends X{constructor(){super()}ddForeach(e){this._debug("ddForeach",`--------- ddForeach (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-foreach",s=this._listElements(t,e);this._debug("ddForeach",`found elements:: ${s.length}`,"navy");for(const n of s){const i=n.getAttribute(t),{base:r,opts:d}=this._decomposeAttribute(i),{val:o,prop_solved:l}=this._solveBase(r);if(!o){this._printError(`The ${r} has undefined value in dd-foreach="${i}"`);continue}this.$debugOpts.ddForeach&&console.log(`
ddForeach:: attrVal:: ${i} , base:: ${r} , prop_solved:: ${l} -->`,o);const[a,c]=d.length?d[0].split(",").map(v=>v.trim()):[];if(!this._isValidVariableName(a)){this._printError(`dd-foreach="${i}" has invalid valName:${a}`);continue}if(!this._isValidVariableName(c)){this._printError(`dd-foreach="${i}" has invalid keyName:${c}`);continue}this._clone_remove(n,t),this._setDdRender(n,"disabled");const h=this._clone_define(n,t,i);this._elemShow(h,t),this._setDdRender(h,"enabled"),this._delDdRender(h,"disabled");const p=h.outerHTML,u="dd-foreach-child",f=n.querySelector(`[${u}]`),b=f?f.getAttribute(`${u}`):"",{base:m,opts:y}=this._decomposeAttribute(b),[$,g]=y.length?y[0].split(",").map(v=>v.trim()):[];if(!this._isValidVariableName($)){this._printError(`dd-foreach="${i}" has invalid valName:${$}`);continue}if(!this._isValidVariableName(g)){this._printError(`dd-foreach="${i}" has invalid keyName:${g}`);continue}const w=f?f.outerHTML:"",D="dd-foreach-grandchild",A=f?f.querySelector(`[${D}]`):null,P=A?A.getAttribute(`${D}`):"",{base:S,opts:R}=this._decomposeAttribute(P),[L,k]=R.length?R[0].split(",").map(v=>v.trim()):[];if(!this._isValidVariableName(L)){this._printError(`dd-foreach="${i}" has invalid valName:${L}`);continue}if(!this._isValidVariableName(k)){this._printError(`dd-foreach="${i}" has invalid keyName:${k}`);continue}const H=A?A.outerHTML:"";let B="";o.forEach((v,T)=>{let x=[];m&&m.includes("this.")?x=this._solveExpression(m):m&&m.includes(a)&&(x=this._solveExpression(m,{[a]:v}));let q="";x&&x.forEach((M,O)=>{let F=[];S&&S.includes("this.")?F=this._solveExpression(S):S&&S.includes($)&&(F=this._solveExpression(S,{[$]:M}));let j="";F&&F.forEach((U,J)=>{const W=A?"`"+H+"`":"";j+=this._solveExpression(W,{[a]:v},{[c]:T},{[$]:M},{[g]:O},{[L]:U},{[k]:J})});let V="`"+w+"`";V=A?("`"+w+"`").replace(H,j):"`"+w+"`",V=this._solveDoubledollar(V,m,$,O),q+=this._solveExpression(V,{[a]:v},{[c]:T},{[$]:M},{[g]:O})});let N=f?("`"+p+"`").replace(w,q):"`"+p+"`";N=this._solveDoubledollar(N,r,a,T),B+=this._solveExpression(N,{[a]:v},{[c]:T})}),n.insertAdjacentHTML("afterend",B)}this._debug("ddForeach","--------- ddForeach (end) ------","navy","#B6ECFF")}ddEach(e){this._debug("ddEach",`--------- ddEach (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-each",s=this._listElements(t,e);this._debug("ddEach",`found elements:: ${s.length}`,"navy");for(const n of s){const i=n.getAttribute(t),{base:r,opts:d}=this._decomposeAttribute(i),{val:o,prop_solved:l}=this._solveBase(r);if(!o){this._printError(`The ${r} has undefined value in dd-each="${i}"`);continue}this.$debugOpts.ddEach&&console.log(`
ddEach:: attrVal:: ${i} , base:: ${r} , prop_solved:: ${l} -->`,o);const[a,c]=d.length?d[0].split(",").map(f=>f.trim()):[];if(!this._isValidVariableName(a)){this._printError(`dd-each="${i}" has invalid valName:${a}`);continue}if(!this._isValidVariableName(c)){this._printError(`dd-each="${i}" has invalid keyName:${c}`);continue}this._clone_remove(n,t),this._setDdRender(n,"disabled");const h=this._clone_define(n,t,i);this._elemShow(h,t),this._setDdRender(h,"enabled"),this._delDdRender(h,"disabled");const p=h.outerHTML;let u="";o.forEach((f,b)=>{const m="`"+p+"`";u+=this._solveExpression(m,{[a]:f},{[c]:b}),u=this._solveDoubledollar(u,r,a,b)}),n.insertAdjacentHTML("afterend",u)}}ddLoop(e){this._debug("ddLoop",`--------- ddLoop (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-loop",s=this._listElements(t,e);this._debug("ddLoop",`found elements:: ${s.length}`,"navy");let n=[...s].reverse();n=this._sortElements(n);for(const i of n){const r=i.getAttribute(t),{base:d,opts:o}=this._decomposeAttribute(r),{val:l,prop_solved:a}=this._solveBase(d);if(!l){this._printError(`The ${d} has undefined value in dd-loop="${r}"`);continue}this.$debugOpts.ddLoop&&console.log(`
ddLoop:: attrVal:: ${r} , base:: ${d} , prop_solved:: ${a} -->`,l),this._clone_remove(i,t),this._setDdRender(i,"disabled");const c=i.getAttribute("dd-id"),h=this._hasDirectives(i,["dd-repeat","dd-mustache"]);if(h){this._printError(`dd-loop="${r}" dd-id="${c}" contains ${h}`);continue}if(!Array.isArray(l)){this._printWarn(`dd-loop="${r}" dd-id="${c}" -> The value is not array. Value is: ${JSON.stringify(l)}`);continue}if(!l.length)continue;if(!o||o&&!o.length){this._printError(`dd-loop="${r}" dd-id="${c}" -> The option --val,key is not written`);continue}const[p,u]=o[0].split(",").map(y=>y.trim());if(!this._isValidVariableName(p)){this._printError(`dd-loop="${r}" dd-id="${c}" has invalid valName ${p}`);continue}if(!this._isValidVariableName(u)){this._printError(`dd-loop="${r}" dd-id="${c}" has invalid valName ${u}`);continue}const f=this._clone_define(i,t,r);this._delDdRender(f,"disabled"),this._setDdRender(f,"enabled"),this._elemShow(f,t);const b=f.querySelector("[dd-foreach]");b&&b.remove();const m=o[1];l.forEach((y,$)=>{let g=f.outerHTML.replace(/\s+/g," ").replace(/\n/g,"").trim();this._debug("ddLoop",`- ddLoop ${m||""}:: outerhtml (before):: ${g}`,"navy");const w=u?{[p]:y,[u]:$}:{[p]:y};g=this._solveTemplateLiteral(g,w,m),g=this._solveDoubledollar(g,d,p,$),this._debug("ddLoop",`                  outerhtml (after):: ${g}`,"navy"),i.insertAdjacentHTML("beforebegin",g)})}this._debug("ddLoop","--------- ddLoop (end) ------","navy","#B6ECFF")}ddRepeat(e){this._debug("ddRepeat",`--------- ddRepeat (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-repeat",s=this._listElements(t,e);this._debug("ddRepeat",`found elements:: ${s.length}`,"navy");const n=[...s].reverse();for(const i of n){const r=i.getAttribute(t),{base:d}=this._decomposeAttribute(r),{val:o,prop_solved:l}=this._solveBase(d);if(!o){this._printError(`The ${d} has undefined value in dd-repeat="${r}"`);continue}this._debug("ddRepeat",`dd-repeat="${r}" :: ${d} --> ${l} = ${o}`,"navy"),this._clone_remove(i,t),this._setDdRender(i,"disabled");const a=i.getAttribute("dd-id"),c=this._hasDirectives(i,["dd-foreach","dd-mustache"]);if(c){this._printError(`dd-repeat="${r}" dd-id="${a}" contains ${c}`);continue}const h=+o;if(h)for(let p=1;p<=h;p++){const u=this._clone_define(i,t,r);this._delDdRender(u,"disabled"),this._elemShow(u,t),this._clone_insert(i,u)}}this._debug("ddRepeat","--------- ddRepeat (end) ------","navy","#B6ECFF")}ddMustache(e){this._debug("ddMustache",`--------- ddMustache (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-mustache";let s=this._listElements(t,"");e&&(s=s.filter(n=>n.outerHTML.includes(`$model.${e}`))),this._debug("ddMustache",`found elements:: ${s.length}`,"navy");for(const n of s){this._clone_remove_ddMustache(n,t),this._setDdRender(n,"disabled"),this._delDdRender(n,"enabled"),this.$debugOpts.ddMustache&&console.log(`
dd-mustache elem::`,n);const i=n.getAttribute("dd-id"),r=this._hasDirectives(n,["dd-repeat"]);if(r){this._printError(`dd-mustache dd-id="${i}" contains ${r}`);continue}const d=this._clone_define(n,t,"");this._delDdRender(d,"disabled"),d.innerHTML=this._solveMustache(d.innerHTML);for(const o of d.attributes)o.value=this._solveMustache(o.value);this._elemShow(d,t),this._clone_insert(n,d),this.$debugOpts.ddMustache&&console.log("dd-mustache clonedElem::",d)}this._debug("ddMustache","--------- ddMustache (end) ------","navy","#B6ECFF")}}class Q extends Z{constructor(){super(),this.$dd={listeners:[],noncloner_directives:["dd-setinitial","dd-elem","dd-if","dd-elseif","dd-else","dd-visible","dd-text","dd-html","dd-value","dd-disabled","dd-checked","dd-selected","dd-class","dd-style","dd-src","dd-attr"],cloner_directives:["dd-foreach","dd-each","dd-loop","dd-repeat","dd-mustache"]},this.$elem={}}ddSetinitial(){this._debug("ddSetinitial","--------- ddSetinitial ------","navy","#B6ECFF");const e="dd-setinitial",t=this._listElements(e);this._debug("ddSetinitial",`found elements:: ${t.length}`,"navy");for(const s of t){const n=s.getAttribute(e),{base:i,opts:r}=this._decomposeAttribute(n);let d=i.replace(/^this\./,"");d=this._solveMustache(d);const o=r[0]==="convertType",l=this._getElementValue(s,o);this._setControllerValue(d,l),this._debug("ddSetinitial",`dd-setinitial="${n}" :: ${i} --> ${d} = ${l} , convertType: ${o}`,"navy"),this._elemShow(s,e)}this._debug("ddSetinitial","--------- ddSetinitial (end) ------","navy","#B6ECFF")}ddElem(){this._debug("ddElem","--------- ddElem ------","navy","#B6ECFF");const e="dd-elem",t=this._listElements(e,"");this._debug("ddElem",`found elements:: ${t.length}`,"navy");for(const s of t){const n=s.getAttribute(e)||"",{base:i}=this._decomposeAttribute(n);this.$elem[i]=s,this._elemShow(s,e)}}ddText(e){this._debug("ddText",`--------- ddText (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-text",s=this._listElements(t,e);this._debug("ddText",`found elements:: ${s.length} `,"navy");for(const n of s){const i=n.getAttribute(t),{base:r,opts:d}=this._decomposeAttribute(i),{val:o,prop_solved:l}=this._solveBase(r);this._debug("ddText",`dd-text="${i}" :: ${r} --> ${l} = ${o}`,"navy");let a=this._val2str(o);o==null&&(a="");const c=d.find(h=>h.includes("pipe:"));c&&(a=this._pipeExe(a,c)),n.textContent=a,this._elemShow(n,t)}this._debug("ddText","--------- ddText (end) ------","navy","#B6ECFF")}ddHtml(e){this._debug("ddHtml",`--------- ddHtml (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-html",s=this._listElements(t,e);this._debug("ddHtml",`found elements:: ${s.length} `,"navy");for(const n of s){const i=n.getAttribute(t),{base:r,opts:d}=this._decomposeAttribute(i),{val:o,prop_solved:l}=this._solveBase(r);this._debug("ddHtml",`dd-html="${i}" :: ${r} --> ${l} = ${o}`,"navy");let a=this._val2str(o);if(o==null&&(a=""),a.includes("dd-")){const h=a.includes("<td")?document.createElement("table"):document.createElement("div");h.innerHTML=a;const p=[...this.$dd.noncloner_directives,...this.$dd.cloner_directives];for(const u of p){const f=h.querySelectorAll(`[${u}]`);for(const b of f)this._elemHide(b,u),this._uid(b)}a=h.innerHTML}const c=d.find(h=>h.includes("pipe:"));c&&(a=this._pipeExe(a,c)),n.innerHTML=a,this._elemShow(n,t)}this._debug("ddHtml","--------- ddHtml (end) ------","navy","#B6ECFF")}ddValue(e){this._debug("ddValue",`--------- ddValue (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-value",s=this._listElements(t,e);this._debug("ddValue",`found elements:: ${s.length}`,"navy");for(const n of s){const i=n.getAttribute(t),{base:r}=this._decomposeAttribute(i),{val:d,prop_solved:o}=this._solveBase(r);this._debug("ddValue",`dd-value="${i}" :: ${r} --> ${o} = ${d}`,"navy"),this._elemShow(n,t),d!=null&&this._setElementValue(n,d)}this._debug("ddValue","--------- ddValue (end) ------","navy","#B6ECFF")}ddDisabled(e){this._debug("ddDisabled",`--------- ddDisabled (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-disabled",s=this._listElements(t,e);this._debug("ddDisabled",`found elements:: ${s.length}`,"navy");for(const n of s){const i=n.getAttribute(t),{base:r}=this._decomposeAttribute(i),{val:d,prop_solved:o}=this._solveBase(r);this._debug("ddDisabled",`dd-disabled="${i}" :: ${r} --> ${o} = ${d}`,"navy"),n.disabled=!!d,this._elemShow(n,t)}this._debug("ddDisabled","--------- ddDisabled (end) ------","navy","#B6ECFF")}ddChecked(e){this._debug("ddChecked",`--------- ddChecked (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-checked",s=this._listElements(t,e);this._debug("ddChecked",`found elements:: ${s.length}`,"navy");for(const n of s){const i=n.getAttribute(t),{base:r}=this._decomposeAttribute(i),{val:d,prop_solved:o}=this._solveBase(r);this._debug("ddChecked",`dd-checked="${i}" :: ${r} --> ${o} = ${d}`,"navy"),this._elemShow(n,t),d!==void 0&&(n.type==="checkbox"?(!Array.isArray(d)&&this._printError(`The checkbox expects an array. The incorrect value is ${d}.`),Array.isArray(d)&&d.indexOf(n.value)!==-1?(n.checked=!0,n.setAttribute("checked","")):(n.checked=!1,n.removeAttribute("checked"))):n.type==="radio"&&(Array.isArray(d)&&this._printError(`The radio doesn't expect an array. The incorrect value is ${d}.`),d===n.value?(n.checked=!0,n.setAttribute("checked","")):(n.checked=!1,n.removeAttribute("checked"))),this._debug("ddChecked",`   elem.value: ${n.value} ; elem.checked: ${n.checked}`,"navy"))}this._debug("ddChecked","--------- ddChecked (end) ------","navy","#B6ECFF")}ddSelected(e){this._debug("ddSelected",`--------- ddSelected (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-selected",s=this._listElements(t,e);this._debug("ddSelected",`found elements:: ${s.length}`,"navy");for(const n of s){const i=n.getAttribute(t),{base:r}=this._decomposeAttribute(i),{val:d,prop_solved:o}=this._solveBase(r);if(this._debug("ddSelected",`dd-selected="${i}" :: ${r} --> ${o} = ${d}`,"navy"),this._elemShow(n,t),d!==void 0){if(n.type==="select-multiple"){!Array.isArray(d)&&this._printError(`The select-multiple expects an array. The incorrect value is ${d}.`);for(const l of n.options)l.selected=Array.isArray(d)&&d.indexOf(l.value)!==-1}else if(n.type==="select-one"){Array.isArray(d)&&this._printError(`The select-one doesn't expect an array. The incorrect value is ${d}.`);for(const l of n.options)l.selected=d===l.value}}}this._debug("ddSelected","--------- ddSelected (end) ------","navy","#B6ECFF")}ddClass(e){this._debug("ddClass",`--------- ddClass (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-class",s=this._listElements(t,e);this._debug("ddClass",`found elements:: ${s.length}`,"navy");for(const n of s){const i=n.getAttribute(t),{base:r,opts:d}=this._decomposeAttribute(i),{val:o,prop_solved:l}=this._solveBase(r),a=d&&d[0]?d[0]:"";if(this._debug("ddClass",`dd-class="${i}" :: ${r} --> ${l} = ${JSON.stringify(o)} | act:: ${a}`,"navy"),this._elemShow(n,t),o!==void 0){if(!Array.isArray(o)){this._printWarn(`dd-class="${i}" -> The value is not array.`);continue}a==="replace"&&n.removeAttribute("class");for(const c of o)n.classList.add(c)}}this._debug("ddClass","--------- ddClass (end) ------","navy","#B6ECFF")}ddStyle(e){this._debug("ddStyle",`--------- ddStyle (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-style",s=this._listElements(t,e);this._debug("ddStyle",`found elements:: ${s.length}`,"navy");for(const n of s){const i=n.getAttribute(t),{base:r,opts:d}=this._decomposeAttribute(i),{val:o,prop_solved:l}=this._solveBase(r),a=d[0]||"";if(this._debug("ddStyle",`dd-style="${i}" :: ${r} --> ${l} = ${JSON.stringify(o)} | act:: ${a}`,"navy"),this._elemShow(n,t),o!==void 0){if(typeof o!="object"||typeof o=="object"&&Array.isArray(o)){this._printWarn(`dd-style="${i}" -> The value is not object.`);continue}if(a==="replace"&&n.removeAttribute("style"),o!==null)for(const c of Object.keys(o))n.style[c]=o[c]}}this._debug("ddStyle","--------- ddStyle (end) ------","navy","#B6ECFF")}ddSrc(e){this._debug("ddSrc",`--------- ddSrc (start)  -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-src",s=this._listElements(t,e);this._debug("ddSrc",`found elements:: ${s.length}`,"navy");for(const n of s){const i=n.getAttribute(t),{base:r,opts:d}=this._decomposeAttribute(i),{val:o,prop_solved:l}=this._solveBase(r),a=d[0]||"";this._debug("ddSrc",`dd-src="${i}" :: ${r} --> ${l} = ${o} | defaultSrc:: ${a}`,"navy");const c=o||a;n.src=c,this._elemShow(n,t)}this._debug("ddSrc","--------- ddSrc (end) ------","navy","#B6ECFF")}ddAttr(e){this._debug("ddAttr",`--------- ddAttr (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-attr",s=this._listElements(t,e);this._debug("ddAttr",`found elements:: ${s.length}`,"navy");for(const n of s){const i=n.getAttribute(t),{base:r,opts:d}=this._decomposeAttribute(i),{val:o,prop_solved:l}=this._solveBase(r),a=d[0]||"";if(this._debug("ddAttr",`dd-attr="${i}" :: ${r} --> ${l} = ${o} | attributeName:: ${a}`,"navy"),this._elemShow(n,t),o!=null){if(typeof o!="string"){this._printWarn(`dd-attr="${i}" -> The value is not string.`);continue}if(!a){this._printWarn(`dd-attr="${i}" -> The attribute name is not defined in option.`);continue}n.setAttribute(a,o)}}this._debug("ddAttr","--------- ddAttr (end) ------","navy","#B6ECFF")}ddIf(e){this._debug("ddIf",`--------- ddIf(start) -modelName:${e} ------`,"navy","#B6ECFF");const s=this._listElements("dd-if",e);this._debug("ddIf",`found elements:: ${s.length} `,"navy");for(const n of s){const i=this._getSiblings(n,["dd-if","dd-elseif","dd-else"]);this._debug().ddIf&&console.log(`
--if group--`);for(const r of i)r.style.display="none";for(const r of i){const d=r.getAttribute("dd-if")||r.getAttribute("dd-elseif")||r.getAttribute("dd-else"),{base:o}=this._decomposeAttribute(d),{val:l}=this._solveBase(o);if(this._debug().ddIf&&console.log(r.outerHTML,l),l||r.hasAttribute("dd-else")){r.style.display="",n.getAttribute("style")||n.removeAttribute("style");break}}for(const r of i)this._elemShow(r,"dd-if"),this._elemShow(r,"dd-elseif"),this._elemShow(r,"dd-else");this._debug().ddIf&&console.log("----------")}this._debug("ddIf","--------- ddIf (end) ------","navy","#B6ECFF")}ddVisible(e){this._debug("ddVisible",`--------- ddVisible (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-visible",s=this._listElements(t,e);this._debug("ddVisible",`found elements:: ${s.length}`,"navy");for(const n of s){const i=n.getAttribute(t),{base:r}=this._decomposeAttribute(i),{val:d,prop_solved:o}=this._solveBase(r);this._debug("ddVisible",`dd-visible="${i}" :: ${r} --> ${o} = ${d}`,"navy"),d?n.style.visibility="visible":n.style.visibility="hidden",this._elemShow(n,t)}this._debug("ddVisible","--------- ddVisible (end) ------","navy","#B6ECFF")}}class I{constructor(e){this.url,this.protocol="http:",this.hostname="",this.port=80,this.pathname="/",this.queryString="",e?this.opts=e:this.opts={encodeURI:!1,timeout:8e3,responseType:"",retry:3,retryDelay:5500,maxRedirects:3,headers:{authorization:"",accept:"*/*"}},this.timeout=this.opts.timeout,this.responseType=this.opts.responseType,this.req_headers={...this.opts.headers},this.xhr=new XMLHttpRequest,this.interceptor}async askOnce(e,t="GET",s){const n={requestURL:e,requestMethod:t,status:0,statusMessage:"",https:!1,req:{headers:this.req_headers,payload:void 0},res:{headers:void 0,content:void 0},time:{req:this._getTime(),res:void 0,duration:void 0}};try{e=this._parseUrl(e),n.requestURL=e,n.https=/^https/.test(this.protocol)}catch(r){const d={...n};return d.status=400,d.statusMessage=r.message||"Bad Request",d.time.res=this._getTime(),d.time.duration=this._getTimeDiff(d.time.req,d.time.res),d}if(this.interceptor&&await this.interceptor(),this.xhr.open(t,e,!0,null,null),this._xhr_timeout(this.timeout),this._xhr_responseType(this.responseType),this._xhr_requestHeaders(this.req_headers),s&&!/GET/i.test(t)){n.req.payload=s;const r=this.req_headers["content-type"]||"";let d;/application\/json/.test(r)?d=JSON.stringify(s):d=s,this.xhr.send(d)}else this.xhr.send();return new Promise((r,d)=>{this.xhr.onload=o=>{const l={...n};l.status=this.xhr.status,l.statusMessage=this.xhr.statusText,l.res.headers=this.getResHeaders(),l.res.content=o.target.response,l.time.res=this._getTime(),l.time.duration=this._getTimeDiff(l.time.req,l.time.res),r(l)},this.xhr.onerror=o=>{this.kill();const l=this._formatError(o,e),a={...n};a.status=l.status,a.statusMessage=l.message,a.time.res=this._getTime(),a.time.duration=this._getTimeDiff(a.time.req,a.time.res),r(a)},this.xhr.ontimeout=()=>{this.kill();const o={...n};o.status=408,o.statusMessage=`Request aborted due to timeout (${this.opts.timeout} ms) ${e} `,o.time.res=this._getTime(),o.time.duration=this._getTimeDiff(o.time.req,o.time.res),r(o)},setTimeout(()=>{d(new Error(`Server did not respond and timeout is forced after ${this.timeout} ms.`))},this.timeout)})}async ask(e,t="GET",s){let n=await this.askOnce(e,t,s);const i=[n];let r=1;for(;n&&/^3\d{2}/.test(n.status)&&r<=this.opts.maxRedirects;){const o=new URL(e,n.res.headers.location);console.log(`#${r} redirection ${n.status} from ${this.url} to ${o}`),n=await this.askOnce(o,t,s),i.push(n),r++}let d=1;for(;n.status===408&&d<=this.opts.retry;)console.log(`#${d} retry due to timeout (${this.opts.timeout}) on ${e}`),await new Promise(o=>setTimeout(o,this.opts.retryDelay)),n=await this.askOnce(e,t,s),i.push(n),d++;return i}async askJSON(e,t="GET",s){let n=s;if(s&&typeof s=="string")try{n=JSON.parse(s)}catch{throw new Error("Body string is not valid JSON.")}this.setReqHeaders({accept:"application/json","content-type":"application/json; charset=utf-8"});const i=await this.askOnce(e,t,n);if(i.res.content)try{i.res.content=JSON.parse(i.res.content)}catch{throw new Error("Response content is not valid JSON.")}return i}async askHTML(e){return this.setReqHeaders({accept:"text/html","content-type":"text/html"}),await this.askOnce(e,"GET")}async askJS(e){return this.setReqHeaders({accept:"application/javascript","content-type":"application/javascript; charset=utf-8"}),await this.askOnce(e,"GET")}async sendFormData(e,t){this.setReqHeaders({accept:"*/*","content-type":"multipart/form-data"}),this.delReqHeaders(["content-type"]);const s=await this.askOnce(e,"POST",t);if(s.res.content)try{s.res.content=JSON.parse(s.res.content)}catch{console.log("WARNING: Response content is not JSON.")}return s}object2formdata(e){const t=new FormData;for(const[s,n]of Object.entries(e))t.set(s,n);return t}async sendForm(e,t,s="application/x-www-form-urlencoded"){let n="DodoWebHttpClient";n+=Math.floor(Math.random()*32768),n+=Math.floor(Math.random()*32768),n+=Math.floor(Math.random()*32768),console.log("boundary::",n);const i=`--${n}\r
Content-Disposition: form-data; name="db_id"\r
\r
12345\r
--${n}--`;return console.log("body::",i),await this.askOnce(e,"POST",t)}kill(){this.xhr.abort()}setInterceptor(e){this.interceptor=e.bind(this)}setReqHeaders(e){Object.keys(e).forEach(t=>{const s=t,n=e[t];this.setReqHeader(s,n)})}setReqHeader(e,t){e=e.toLowerCase(),this.req_headers[e]=t}delReqHeaders(e){e.forEach(t=>{t=t.toLowerCase(),delete this.req_headers[t]})}getReqHeaders(){return this.req_headers}getResHeaders(){const t=this.xhr.getAllResponseHeaders().split(`
`),s={};return t.forEach(n=>{const i=n.split(":"),r=i[0];if(r){const d=i[1].trim();s[r]=d}}),s}_parseUrl(e){e=this._correctUrl(e);const t=new URL(e);return this.url=e,this.protocol=t.protocol,this.hostname=t.hostname,this.port=t.port,this.pathname=t.pathname,this.queryString=t.search,e}_correctUrl(e){if(!e)throw new Error("URL is not defined");return e=e.trim(),/^https?:\/\//.test(e)||(e="http://"+e),this.opts.encodeURI?e=encodeURI(e):(e=e.replace(/\s+/g," "),e=e.replace(/ /g,"%20")),e}_formatError(e,t){const s=new Error(e);return e.target.status===0?(s.status=0,s.message=`Status:0 Bad Request ${t}`):(s.status=e.status||400,s.message=e.message),s.original=e,s}_getTime(){return new Date().toISOString()}_getTimeDiff(e,t){const s=new Date(e);return(new Date(t).getTime()-s.getTime())/1e3}_xhr_requestHeaders(e){Object.keys(e).forEach(t=>this.xhr.setRequestHeader(t.toLowerCase(),e[t]))}_xhr_timeout(e){this.xhr.timeout=+e||0}_xhr_responseType(e){this.xhr.responseType=e||"text"}}class ee extends Q{constructor(){super()}loadView(e,t="",s="inner",n=""){const i="dd-view";this.emptyView(e,s);const r=document.querySelector(`[${i}="${e}"]`);if(this._debug("loadView",`--------- loadView dd-view="${e}" ---------`,"#8B0892","#EDA1F1"),!r)throw new Error(`Element dd-view="${e}" not found.`);if(!t)throw new Error(`View content for dd-view="${e}" is not defined.`);let d=t;if(this._debug("loadView",`--htmlstr: ${d.length}`,"#8B0892"),n){const a=new DOMParser().parseFromString(d,"text/html").querySelector(n);d=a?a.outerHTML:""}d=this._hide_ddElements(d),s==="inner"?r.innerHTML=d:s==="sibling"?(r.insertAdjacentHTML("afterend",d),r.nextSibling.setAttribute("dd-view-clone",e)):s==="prepend"?(r.insertAdjacentHTML("afterbegin",d),r.firstElementChild.setAttribute("dd-view-clone",e)):s==="append"&&(r.insertAdjacentHTML("beforeend",d),r.lastElementChild.setAttribute("dd-view-clone",e))}emptyView(e,t="inner"){const s=document.querySelector(`[dd-view="${e}"]`);if(this._debug("emptyView",`--------- emptyView dd-view="${e}" | ${t} ---------`,"#8B0892","#EDA1F1"),this._debug().emptyView&&console.log("emptyView elem::",s),!s)throw new Error(`Element dd-view="${e}" not found.`);if(t==="inner")s.innerHTML="";else if(t==="sibling"||t==="prepend"||t==="append")for(const n of document.querySelectorAll(`[dd-view-clone="${e}"`))n.remove()}loadJS(e,t={}){this.unloadJS(e);const s=document.createElement("script");s.type="text/javascript",s.src=e,t.isModule&&s.setAttribute("type","module"),t.isDefer&&(s.defer=!0),t.isLazy&&s.setAttribute("dd-lazyjs",""),document.body.appendChild(s)}unloadJS(e){const t=document.body.querySelectorAll(`script[src="${e}"]`);for(const s of t)s&&s.remove()}unloadAllJS(e={}){let t="script";e.isModule&&(t+='[type="module"]'),e.isDefer&&(t+="[defer]"),e.isLazy&&(t+="[dd-lazyjs]");const s=document.querySelectorAll(t)||[];for(const n of s)n&&n.remove()}ddLazyjs(e){const t="dd-lazyjs",s=this._listElements(t);for(const n of s){const i=n.getAttribute(t),{opts:r}=this._decomposeAttribute(i);let d=r[0];if(d||(d="after__loader"),d!==e)return;this._debug("ddLazyjs",`--------- ddLazyjs (${e}) ------`,"navy","#B6ECFF");const o=n.getAttribute("src"),l=n.getAttribute("type")==="module",a=n.hasAttribute("defer"),c=n.hasAttribute("dd-lazyjs"),h={isModule:l,isDefer:a,isLazy:c};this.unloadJS(o),this.loadJS(o,h),this._debug("ddLazyjs",`src="${o}" | attrOpts: ${JSON.stringify(h)}`,"navy")}}async exeJS(e=""){const t=Object.getPrototypeOf(async function(){}).constructor;await new t(`${e};`)()}loadCSS(e){this.unloadCSS([e]);const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href",e),t.defer=!0,document.head.appendChild(t)}unloadCSS(e){const t=document.head.querySelectorAll(`link[rel="stylesheet"][href="${e}"]`);for(const s of t)s&&s.remove()}plugCSS(e,t){const s=document.createElement("style");s.textContent=e,s.setAttribute("type","text/css"),s.setAttribute("dd-ref",t),document.head.appendChild(s)}unplugCSS(e){const t=document.querySelector(`style[dd-ref="${e}"]`);t&&t.remove()}setTitle(e){document.title=e}setDescription(e){const t=document.head.querySelector('meta[name="description"]');if(!t)throw new Error('The meta[name="description"] tag is not placed in the HTML file.');t.setAttribute("content",e)}setKeywords(e){const t=document.head.querySelector('meta[name="keywords"]');if(!t)throw new Error('The meta[name="keywords"] tag is not placed in the HTML file.');t.setAttribute("content",e)}setLang(e){document.querySelector("html").setAttribute("lang",e)}async grabFileContent(e=""){const t={encodeURI:!0,timeout:2e4,retry:0,retryDelay:0,maxRedirects:0,headers:{accept:"*/*"}},s=new I(t);let n;if(/^http/.test(e))n=e;else{const d=`${window.location.protocol}//${window.location.host}`;n=new URL(e,d).toString()}const i=await s.askHTML(n);if(!i)throw new Error(`No answer for ${n}`);if(i.status!==200)throw new Error(`Status isn't 200 for ${n}. HTTP Status: ${i.status}`);if(!i.res.content)throw new Error(`Content is empty for ${e}`);let r=i.res.content;return r=r.replace('<script type="module" src="/@vite/client"><\/script>',"").trim(),r}loadI18n(e){const t=window[this.$appName].i18n[e];if(!t)throw new Error(`The language "${e}" is not defined. Please create language files in i18n/${e} folder.`);this.$model.$i18n=t}_hide_ddElements(e){const t=document.createElement("div");t.innerHTML=e;const s=[...this.$dd.noncloner_directives,...this.$dd.cloner_directives];for(const i of s){const r=t.querySelectorAll(`[${i}]`);for(const d of r)this._elemHide(d,i),this._uid(d)}return t.innerHTML}}class te extends ee{constructor(){super(),this.$model={},this.$modeler={},this.$model.on=E.on.bind(E),this.$model.offAll=E.offAll.bind(E)}proxifyModel(){const e={set:(t,s,n)=>{this.$debugOpts.model&&console.log(`DEBUG: Model set trigered. this.$model.${s} = `,n," | __initFinished:",this.__initFinished);const i=Reflect.set(t,s,n);return this.__initFinished&&this.render(s),E.emit("model-change",{modelName:s,modelValue:n}),i}};this.$model=new Proxy(this.$model,e)}modeler(){this.$modeler.use=e=>{if(!this.$model[e]){this._printWarn(`Error in this.$modeler.use('${e}'). Init the this.$model."${e}".`);return}return{setValue:(s,n)=>{const i=n?`$model.${e}.${n}`:`$model.${e}`;this._setControllerValue(i,s),this.render(e)},delValue:s=>{const n=s?`$model.${e}.${s}`:`$model.${e}`;this._setControllerValue(n,void 0),this.render(e)},getValue:s=>{const n=s?`$model.${e}.${s}`:`$model.${e}`;return this._getControllerValue(n)},mpush:s=>{this.$model[e].push(s),this.render(e)},mpop:()=>{this.$model[e].pop(),this.render(e)},munshift:s=>{this.$model[e].unshift(s),this.render(e)},mshift:()=>{this.$model[e].shift(),this.render(e)},mreverse:()=>{this.$model[e].reverse(),this.render(e)},mrender:()=>{this.render(e)}}}}emptyModel(){this.$model={}}isModelEmpty(){return!Object.keys(this.$model).length}}class se extends te{constructor(){super(),this.__initFinished=!1}async controllerMdw(e){this.proxifyModel(),this.modeler();try{await this.__loader(e)}catch(t){console.error(t)}this.ddLazyjs("after__loader"),this.prerender();try{await this.__init(e)}catch(t){console.error(t)}this.__initFinished=!0;try{await this.__rend(e)}catch(t){console.error(t)}this.ddLazyjs("after__rend");try{await this.__postrend(e)}catch(t){console.error(t)}}async __loader(e){throw new Error("The controller method __loader() is not defined. You probably got a blank screen.")}async __init(e){}async __rend(e){await this.render()}async __postrend(e){}async __destroy(){}async render(e,t=30){this._debug("render",`--------- render (start) -- ctrl: ${this.constructor.name} -- renderDelay: ${t}  ------`,"green","#D9FC9B"),this.ddForeach(e),this.ddEach(e),this.ddLoop(e),this.ddRepeat(e),this.ddMustache(e),this.ddElem(e),this.ddText(e),this.ddHtml(e),this.ddValue(e),this.ddDisabled(e),this.ddChecked(e),this.ddSelected(e),this.ddClass(e),this.ddStyle(e),this.ddSrc(e),this.ddAttr(e),this.ddIf(e),this.ddVisible(e),this._purgeDdRender("disabled"),this._purgeDdRender("enabled"),await new Promise(s=>setTimeout(s,t)),this.ddUNLISTEN(),this.ddHref(),this.ddSet(),this.ddModel(),this.ddClick(),this.ddEnter(),this.ddKeyup(),this.ddChange(),this.ddEvt(),this._debug("render",`--------- render (end) -- ctrl: ${this.constructor.name} ------`,"green","#D9FC9B")}prerender(){this.ddSetinitial(),this.ddHref()}}const ne={exeRoute:!1,render:!1,model:!1,ddInc:!1,loadView:!1,unloadView:!1,ddLazyjs:!1,loadHead:!1,ddSetinitial:!1,ddElem:!1,ddValue:!1,ddShow:!1,ddDisabled:!1,ddChecked:!1,ddClass:!1,ddStyle:!1,ddSrc:!1,ddAttr:!1,ddForeach:!1,ddRepeat:!1,ddIf:!1,ddText:!1,ddHtml:!1,ddMustache:!1,ddUNLISTEN:!1,ddHref:!1,ddSet:!1,ddModel:!1,ddClick:!1,ddEnter:!1,ddKeyup:!1,ddChange:!1,ddEvt:!1},ie={encodeURI:!0,timeout:21e3,responseType:"",retry:0,retryDelay:1300,maxRedirects:0,headers:{authorization:"",accept:"*/*","content-type":"text/html; charset=UTF-8"}};new I(ie);const re=`<a href="/" dd-href>HOME</a>
<a href="/page1" dd-href>PAGE 1</a>
<a href="/bad" dd-href>BAD URL</a>
<b>&nbsp;</b>
`,de="POPUP";class oe extends se{constructor(e){super()}async __loader(e){this.setTitle("DoDo - Single Page App Framework"),this.setDescription("DoDo is JS framework for single page applications."),this.setKeywords("dodo, framework, javascript, js, single page app, spa"),this.setLang("en"),this.loadView("#navbar",re),this.loadView("#main",de)}async __init(e){console.log("init() -- trx::",e),console.log("init() -- navig::",C),console.log("init() -- ctrl::",this),this.something="smthng"}async __postrend(e){console.log("postrend() -- trx::",e)}async __destroy(){console.log("destroy() -- navig::",C),console.log("destroy() -- ctrl::",this),this.unloadCSS(["https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism-coy.min.css"]),this.unloadJS()}}const le=new K("myChromeExtension");le.debug(ne).controller(oe);
